(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[594],{1594:(e,o,n)=>{"use strict";n.r(o),n.d(o,{default:()=>h});var s=n(7557),t=n(9526),a=n(2984),i=n(6913),r=n(4333),c=n(8251);const d=(0,t.lazy)((()=>Promise.all([n.e(720),n.e(105)]).then(n.bind(n,6105))));class l extends t.Component{constructor(){super(...arguments),this.state={connected:!1,hasJoin:{user:!1,conversation:!1}},this.componentDidMount=async()=>{const{connected:e,loadNewsAsync:o,loadUserAsync:n,authenticateAsync:s,home:t,newMessage:a,newConversation:i,selectConversation:r}=this.props;await s();c.D.on("connect",(()=>{this.setState({connected:!0})})),c.D.on("disconnect",(()=>{this.setState({connected:!1,hasJoin:{user:!1,conversation:!1}})})),o(),n(),c.D.on("message:new",(e=>{a({...e})})),c.D.on("conversation:new",(e=>{e.id&&this.props.selectConversation(e.id),i({...e}),c.D.emit("conversation:join",{conversations:[e.id]},(e=>{e.ok?console.log("join to conversation rooms",e.data):console.log(e.err)}))}))}}componentDidUpdate(e,o){const{app:n,home:s}=this.props,{connected:t,hasJoin:a}=this.state,i=s.conversations?.data;!a.conversation&&i&&this.setState((e=>({hasJoin:{...e.hasJoin,conversation:!0}})),(()=>{const e=i.map((e=>e.id));c.D.emit("conversation:join",{conversations:e},(e=>{e.ok?console.log("join to conversation rooms",e.data):(this.setState((e=>({hasJoin:{...e.hasJoin,conversation:!1}}))),console.log(e.err))}))})),e.app.loggedIn!==n.loggedIn&&n.loggedIn&&(a.user||this.setState((e=>({hasJoin:{...e.hasJoin,user:!0}})),(()=>{n.user&&c.D.emit("user:join",{user_id:n.user.id},(e=>{e.ok?console.log(`join to user room ${e.data}`):(this.setState((e=>({hasJoin:{...e.hasJoin,user:!1}}))),console.log(e.err))}))})),s.conversations||this.props.loadConversationAsync())}componentWillUnmount(){c.D.disconnect()}render(){return void 0===this.props.app.loggedIn?(0,s.jsxs)("div",Object.assign({className:"flex items-center justify-center w-full h-screen bg-light dark:bg-dark"},{children:[(0,s.jsx)("div",{className:"w-3.5 h-3.5 mx-1 rounded-full bg-primary animate-bounce-step-1"},void 0),(0,s.jsx)("div",{className:"w-3.5 h-3.5 mx-1 rounded-full bg-primary animate-bounce-step-2"},void 0),(0,s.jsx)("div",{className:"w-3.5 h-3.5 mx-1 rounded-full bg-primary animate-bounce-step-3"},void 0)]}),void 0):(0,s.jsx)(t.Suspense,Object.assign({fallback:null},{children:(0,s.jsx)(d,{},void 0)}),void 0)}}const h=(0,a.$j)((e=>({app:e.app,home:e.home})),{connected:i.Bm,loadNewsAsync:r.oU,loadUserAsync:r.C_,authenticateAsync:i.Nz,newMessage:r.rW,newConversation:r.Ki,selectConversation:r.xu,loadConversationAsync:r.a3})(l)},8251:(e,o,n)=>{"use strict";n.d(o,{D:()=>a});var s=n(5615);const t={main:`${n(2838).ho}/`},a=(0,s.io)(t.main)},4333:(e,o,n)=>{"use strict";n.d(o,{oU:()=>a,C_:()=>i,dy:()=>r,a3:()=>c,xu:()=>d,Ki:()=>l,rW:()=>h});var s=n(3730),t=n(5387);const a=()=>(e,o)=>{const n=o().home,a=n.news?.meta.next_page_url||"",i=n.news?.meta.next_page_url;n.news&&!i||t.h.post(`/news${a}`).then((o=>{var n;e((n=o.data,{type:s.Gg,payload:{news:n}}))})).catch((e=>{console.error(e)}))},i=()=>(e,o)=>{o().home.users||t.h.post("/users").then((o=>{var n;e((n={data:o.data},{type:s.vu,payload:{user:n}}))})).catch((e=>{console.error(e)}))},r=e=>({type:s.Aq,payload:{id:e}}),c=e=>(o,n)=>{const{app:a,home:i}=n(),r=a.auth?.token||"";i.conversations||t.h.post("/conversations",{},{headers:{Authorization:`Bearer ${r}`}}).then((e=>{var n;o((n={data:e.data},{type:s.Eq,payload:{conversation:n}}))})).catch((e=>{console.error(e)})).finally((()=>{e&&e()}))},d=e=>({type:s.tr,payload:{id:e}}),l=e=>({type:s.$t,payload:{...e}}),h=e=>({type:s.$v,payload:{...e}})}}]);