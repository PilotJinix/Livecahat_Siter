(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[594],{1594:(e,o,n)=>{"use strict";n.r(o),n.d(o,{default:()=>p});var s=n(7557),t=n(9526),a=n(2984),c=n(6913),r=n(4333),i=n(8251);const d=(0,t.lazy)((()=>Promise.all([n.e(720),n.e(105)]).then(n.bind(n,6105))));class l extends t.Component{constructor(){super(...arguments),this.state={connected:!1,hasJoin:{user:!1,conversation:!1}},this.componentDidMount=async()=>{const{connected:e,loadNewsAsync:o,loadUserAsync:n,authenticateAsync:s,home:t,newMessage:a,newConversation:c}=this.props;await s();i.D.on("connect",(()=>{this.setState({connected:!0})})),i.D.on("disconnect",(()=>{this.setState({connected:!1,hasJoin:{user:!1,conversation:!1}})})),o(),n(),i.D.on("message:new",(e=>{a({...e})})),i.D.on("conversation:new",(e=>{console.log("on conversation:new"),console.log(e),c({...e})}))}}componentDidUpdate(e,o){const{app:n,home:s}=this.props,{connected:t,hasJoin:a}=this.state;console.log(this.state);const c=s.conversations?.data;if(o.connected!==t||e.app.loggedIn!==n.loggedIn||c){if(!a.conversation&&t&&c){const e=c.map((e=>e.id));i.D.emit("conversation:join",{conversations:e},(e=>{e.ok?this.setState((e=>({hasJoin:{...e.hasJoin,conversation:!0}}))):console.log(e.err)}))}!a.user&&n.loggedIn&&t&&n.user?.id&&i.D.emit("user:join",{user_id:n.user.id},(e=>{e.ok?(console.log(`user join to room ${e.data}`),this.setState((e=>({hasJoin:{...e.hasJoin,user:!0}})))):console.log(e.err)}))}}componentWillUnmount(){i.D.disconnect()}render(){return void 0===this.props.app.loggedIn?(0,s.jsxs)("div",Object.assign({className:"flex items-center justify-center w-full h-screen bg-light dark:bg-dark"},{children:[(0,s.jsx)("div",{className:"w-3.5 h-3.5 mx-1 rounded-full bg-primary animate-bounce-step-1"},void 0),(0,s.jsx)("div",{className:"w-3.5 h-3.5 mx-1 rounded-full bg-primary animate-bounce-step-2"},void 0),(0,s.jsx)("div",{className:"w-3.5 h-3.5 mx-1 rounded-full bg-primary animate-bounce-step-3"},void 0)]}),void 0):(0,s.jsx)(t.Suspense,Object.assign({fallback:null},{children:(0,s.jsx)(d,{},void 0)}),void 0)}}const p=(0,a.$j)((e=>({app:e.app,home:e.home})),{connected:c.Bm,loadNewsAsync:r.oU,loadUserAsync:r.C_,authenticateAsync:c.Nz,newMessage:r.rW,newConversation:r.Ki})(l)},8251:(e,o,n)=>{"use strict";n.d(o,{D:()=>a});var s=n(5615);const t={main:`${n(2838).ho}/`},a=(0,s.io)(t.main)},4333:(e,o,n)=>{"use strict";n.d(o,{oU:()=>a,C_:()=>c,dy:()=>r,a3:()=>i,xu:()=>d,Ki:()=>l,rW:()=>p});var s=n(3730),t=n(5387);const a=()=>(e,o)=>{const n=o().home,a=n.news?.meta.next_page_url||"",c=n.news?.meta.next_page_url;n.news&&!c||t.h.post(`/news${a}`).then((o=>{var n;e((n=o.data,{type:s.Gg,payload:{news:n}}))})).catch((e=>{console.error(e)}))},c=()=>(e,o)=>{o().home.users||t.h.post("/users").then((o=>{var n;e((n={data:o.data},{type:s.vu,payload:{user:n}}))})).catch((e=>{console.error(e)}))},r=e=>({type:s.Aq,payload:{id:e}}),i=()=>(e,o)=>{const{app:n,home:a}=o(),c=n.auth?.token||"";a.conversations||t.h.post("/conversations",{},{headers:{Authorization:`Bearer ${c}`}}).then((o=>{var n;e((n={data:o.data},{type:s.Eq,payload:{conversation:n}}))})).catch((e=>{console.error(e)}))},d=e=>({type:s.tr,payload:{id:e}}),l=e=>({type:s.$t,payload:{...e}}),p=e=>({type:s.$v,payload:{...e}})}}]);